# RepoBeam

> An LLM-friendly code browsing platform that serves GitHub repositories in smart, token-efficient chunks.

[![Next.js](https://img.shields.io/badge/Next.js-16.1-black)](https://nextjs.org/)
[![Supabase](https://img.shields.io/badge/Supabase-2.95-3ECF8E)](https://supabase.com/)
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

## Features

- **Symbol Navigation**: Jump directly to functions, classes, and types
- **Token-Aware Responses**: Every response includes token counts and truncation hints
- **Smart Search**: Full-text code search with fuzzy symbol matching
- **Incremental Sync**: Only re-analyzes changed files using LLM-based extraction
- **LLM-First API**: Designed for AI agents with comprehensive `/api/help` endpoint
- **Multi-Repo Support**: Index and search across multiple repositories
- **Modern UI**: Clean, minimal interface built with shadcn/ui

## Quick Start

### Prerequisites

- Node.js 18+
- Supabase account (for database)
- GitHub Personal Access Token
- NVIDIA NIM API key (for LLM symbol extraction)

### Installation

```bash
git clone https://github.com/your-org/repobeam.git
cd repobeam
npm install
```

### Environment Variables

Copy `.env.example` to `.env.local`:

```bash
cp .env.example .env.local
```

Configure your environment:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# GitHub
GITHUB_TOKEN=your_github_pat
GITHUB_WEBHOOK_SECRET=your_webhook_secret

# API
API_KEY=your_api_key

# NVIDIA NIM (for LLM-based symbol extraction)
# Get free API key at: https://build.nvidia.com/
NIM_API_KEY=your_nim_api_key

# Internal (for web UI auth bypass)
INTERNAL_SECRET=your_internal_secret
```

### Database Setup

1. Create a new Supabase project
2. Run the SQL migration in `supabase/migration.sql` to create tables:

```sql
-- Repositories table
CREATE TABLE repos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  owner TEXT NOT NULL,
  name TEXT NOT NULL,
  full_name TEXT NOT NULL UNIQUE,
  description TEXT,
  language TEXT,
  last_sha TEXT,
  last_synced_at TIMESTAMPTZ
);

-- Files table
CREATE TABLE files (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  repo_id BIGINT REFERENCES repos(id) ON DELETE CASCADE,
  path TEXT NOT NULL,
  content TEXT NOT NULL,
  language TEXT,
  token_count INTEGER,
  line_count INTEGER,
  last_sha TEXT,
  UNIQUE(repo_id, path)
);

-- Symbols table (extracted by LLM)
CREATE TABLE symbols (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  file_id BIGINT REFERENCES files(id) ON DELETE CASCADE,
  name TEXT NOT NULL,
  kind TEXT NOT NULL,
  signature TEXT,
  start_line INTEGER NOT NULL,
  end_line INTEGER NOT NULL,
  token_count INTEGER,
  parent_symbol BIGINT
);

-- Indexes for search
CREATE INDEX idx_files_repo ON files(repo_id);
CREATE INDEX idx_symbols_file ON symbols(file_id);
CREATE INDEX idx_symbols_name ON symbols(name);
CREATE INDEX idx_symbols_kind ON symbols(kind);
```

### Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000).

## API Overview

### Authentication

All endpoints (except `/api/help`) require:

```
Authorization: Bearer <API_KEY>
```

### Core Endpoints

| Endpoint | Description |
|----------|-------------|
| `GET /api/help` | API documentation (no auth required) |
| `GET /api/repos` | List all repositories |
| `POST /api/repos` | Add a repository |
| `DELETE /api/repos/:id` | Remove a repository |
| `GET /api/sync?repo=:repo` | Get sync status |
| `POST /api/sync?repo=:repo&force=true` | Trigger sync |
| `GET /api/tree?repo=:repo` | Get file tree |
| `GET /api/file?repo=:repo&path=:path` | Get file content |
| `GET /api/symbols?repo=:repo&path=:path` | List symbols in file |
| `GET /api/function?repo=:repo&path=:path&name=:name` | Get single symbol |
| `GET /api/search?repo=:repo&q=:query` | Search code |
| `GET /api/symbols/search?repo=:repo&q=:query` | Search symbols |
| `GET /api/outline?repo=:repo&path=:path` | Get file structure |
| `GET /api/dependencies?repo=:repo&path=:path` | Get file imports |
| `GET /api/references?repo=:repo&symbol=:name` | Find symbol usage |
| `GET /api/stats?repo=:repo` | Get repository stats |

### Response Format

All JSON responses follow this envelope:

```json
{
  "_meta": {
    "total_tokens": 1234,
    "truncated": false,
    "hint": "Add ?startLine=801 to continue"
  },
  "data": { ... }
}
```

### Example Usage

```bash
# Add a repository
curl -X POST https://repobeam.com/api/repos \
  -H "Authorization: Bearer $API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"owner": "facebook", "name": "react"}'

# Get symbols in a file
curl https://repobeam.com/api/symbols?repo=facebook/react&path=src/React.js \
  -H "Authorization: Bearer $API_KEY"

# Search for a function
curl https://repobeam.com/api/symbols/search?repo=facebook/react&q=useState \
  -H "Authorization: Bearer $API_KEY"

# Get specific function
curl https://repobeam.com/api/function?repo=facebook/react&path=src/React.js&name=useState \
  -H "Authorization: Bearer $API_KEY"
```

## LLM Integration

The API is designed for AI agents. Point any LLM with web access to:

```
https://repobeam.com/api/help
```

The LLM will discover all available endpoints and can intelligently fetch code.

### Example for LLMs

```
User: "What does the useState function do in React?"

LLM Steps:
1. GET /api/symbols/search?repo=facebook/react&q=useState
2. GET /api/function?repo=facebook/react&path=...&name=useState
3. Explain the function with its implementation
```

## Symbol Extraction

RepoBeam uses NVIDIA NIM's LLM to extract symbols from source code:

- **Model**: `qwen/qwen2.5-coder-32b-instruct`
- **Languages**: C, C++, Python, JavaScript, TypeScript, Rust, Go, Java, and more
- **Caching**: Symbols are cached after first extraction
- **Incremental**: Only changed files are re-analyzed

## Deployment

### Vercel

```bash
npm run build
vercel --prod
```

### Docker

```bash
docker build -t repobeam .
docker run -p 3000:3000 --env-file .env.local repobeam
```

## Environment Variables Reference

| Variable | Required | Description |
|----------|----------|-------------|
| `NEXT_PUBLIC_SUPABASE_URL` | Yes | Supabase project URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Yes | Supabase anonymous key |
| `SUPABASE_SERVICE_ROLE_KEY` | Yes | Supabase service role key |
| `GITHUB_TOKEN` | Yes | GitHub Personal Access Token |
| `GITHUB_WEBHOOK_SECRET` | No | GitHub webhook secret |
| `API_KEY` | Yes | API key for client authentication |
| `NIM_API_KEY` | Yes | NVIDIA NIM API key for symbol extraction |
| `INTERNAL_SECRET` | Yes | Secret for internal web UI auth bypass |

## Project Structure

```
repobeam/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── api/               # API routes
│   │   ├── repo/              # Repository browser UI
│   │   ├── search/            # Search UI
│   │   └── page.tsx           # Homepage
│   ├── components/ui/         # shadcn/ui components
│   ├── lib/                   # Utility functions
│   │   ├── api.ts            # API helpers
│   │   ├── sync.ts           # Repository sync logic
│   │   ├── symbols.ts        # LLM symbol extraction
│   │   ├── github.ts         # GitHub API client
│   │   └── supabase.ts       # Database client
│   └── styles/                # Global styles
├── supabase/                  # Database migrations
└── public/                    # Static assets
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

## License

MIT License - see LICENSE for details.

## Acknowledgments

- Built with [Next.js](https://nextjs.org/)
- UI components from [shadcn/ui](https://ui.shadcn.com/)
- Database powered by [Supabase](https://supabase.com/)
- Symbol extraction powered by [NVIDIA NIM](https://build.nvidia.com/)
